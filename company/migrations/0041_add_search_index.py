# -*- coding: utf-8 -*-
# Generated by Django 1.9.13 on 2017-05-03 16:01
from __future__ import unicode_literals

from django.db import migrations

from elasticsearch_dsl import Index, analyzer

from company.search import CompanyDocType


def add_company_search_index(apps, schema_editor):
    companies = Index('companies')
    companies.doc_type(CompanyDocType)

    english_analyzer = analyzer(
        'english_analyzer',
        tokenizer="standard",
        filter=[
            "english_possessive_stemmer",
            "lowercase",
            "english_stop",
            "english_keywords",
            "english_stemmer"
        ]
    )
    companies.analyzer(english_analyzer)

    companies.create()


def remove_company_search_index(apps, schema_editor):
    companies = Index('companies')
    companies.delete()


class Migration(migrations.Migration):

    dependencies = [
        ('company', '0040_remove_company_contact_details'),
    ]

    operations = [
        migrations.RunPython(
            add_company_search_index, remove_company_search_index
        )
    ]
